<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="LegalConnect - Find the right legal professional for your needs in Western Sydney, Australia">
  <title>LegalConnect | Find Your Perfect Legal Match</title>
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="">
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css">
  
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: {
              50: '#eff6ff',
              100: '#dbeafe',
              200: '#bfdbfe',
              300: '#93c5fd',
              400: '#60a5fa',
              500: '#3b82f6',
              600: '#2563eb',
              700: '#1d4ed8',
              800: '#1e40af',
              900: '#1e3a8a',
            },
            navy: {
              800: '#1a2744',
              900: '#0f172a',
              950: '#0a1120',
            },
            gold: '#e5a835'
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
            display: ['Playfair Display', 'Georgia', 'serif'],
          }
        }
      }
    }
  </script>
  
  <style>
    body { font-family: 'Inter', system-ui, sans-serif; }
    .font-display { font-family: 'Playfair Display', Georgia, serif; }
    
    /* Leaflet customizations */
    .leaflet-container { font-family: 'Inter', sans-serif; }
    
    /* Custom popup styling for lawyer cards on map */
    .lawyer-marker-popup .leaflet-popup-content-wrapper { 
      border-radius: 12px; 
      box-shadow: 0 4px 20px rgba(0,0,0,0.2); 
      padding: 0; 
      overflow: hidden;
      border: none;
    }
    .lawyer-marker-popup .leaflet-popup-content { 
      margin: 0; 
      min-width: 220px; 
    }
    .lawyer-marker-popup .leaflet-popup-tip {
      background: white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    /* Ensure popup is interactive and stays visible */
    .leaflet-popup {
      pointer-events: auto !important;
    }
    .leaflet-popup-pane {
      z-index: 700 !important;
    }
    
    /* Name labels on map when zoomed in */
    .lawyer-name-label {
      background: transparent !important;
      border: none !important;
      box-shadow: none !important;
    }
    
    /* Scrollbar */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: #f1f5f9; }
    ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    
    /* Focus styles */
    *:focus-visible { outline: 2px solid #3b82f6; outline-offset: 2px; }
    
    /* Smooth scroll */
    html { scroll-behavior: smooth; }
    
    /* Card active state */
    .lawyer-card { transition: all 0.2s ease; }
    .lawyer-card.active { border-color: #3b82f6; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15); }
    
    /* Modal backdrop - VERY HIGH z-index to appear over map */
    .modal-backdrop { 
      backdrop-filter: blur(4px); 
      z-index: 10000 !important;
    }
    .modal-content {
      z-index: 10001 !important;
    }
    
    /* Marker cluster */
    .marker-cluster-small, .marker-cluster-medium, .marker-cluster-large {
      background-color: rgba(59, 130, 246, 0.3);
    }
    .marker-cluster-small div, .marker-cluster-medium div, .marker-cluster-large div {
      background-color: #2563eb;
      color: white;
      font-weight: 600;
    }
    
    /* Category button styles */
    .category-pill {
      transition: all 0.2s ease;
    }
    .category-pill:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .category-pill.active {
      background-color: #e5a835;
      color: #0f172a;
    }
    
    /* Hero gradient */
    .hero-gradient {
      background: linear-gradient(180deg, #0f172a 0%, #1a2744 100%);
    }
    
    /* Glass card effect */
    .glass-card {
      background: rgba(30, 41, 59, 0.8);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    /* Map border - pipe style */
    .map-container {
      border: 4px solid #cbd5e1;
      border-radius: 12px;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.1), 0 4px 12px rgba(0,0,0,0.1);
    }

    /* Animation */
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-fade-in-up {
      animation: fadeInUp 0.5s ease-out;
    }

    /* Logo gradient */
    .logo-icon {
      background: linear-gradient(135deg, #2563eb 0%, #0f172a 100%);
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen">
  <div id="root"></div>
  
  <!-- React & ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <!-- Leaflet -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
  
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
  
  <script>
    // ============================================
    // LAWYER DATA (Pre-geocoded, Parramatta only)
    // ============================================
    const LAWYERS_DATA = {
      "Family Law": [
        {
          id: "PAR-FAM-01",
          fullName: "Justin Dowd",
          title: "National Legal Consultant",
          firmName: "Watts McCray",
          isSpecialist: true,
          officeAddress: "Level 1, 100 George St, Parramatta NSW 2150",
          coordinates: { lat: -33.8135, lng: 151.0034 },
          languages: ["English"],
          officialBio: "https://www.wattsmccray.com.au/our-people/justin-dowd/",
          assessment: "Former Law Society President; peak authority on international property splits.",
          seniorityTier: "Partner Emeritus"
        },
        {
          id: "PAR-FAM-02",
          fullName: "Carolyn Munk",
          title: "Partner",
          firmName: "Matthews Folbigg",
          isSpecialist: true,
          officeAddress: "Level 7, 10-14 Smith St, Parramatta NSW 2150",
          coordinates: { lat: -33.8152, lng: 151.0041 },
          languages: ["English"],
          officialBio: "https://www.matthewsfolbigg.com.au/our-people/family-law/carolyn-munk/",
          assessment: "Doyles Guide Preeminent Specialist; elite in high-conflict parenting disputes.",
          seniorityTier: "Partner"
        },
        {
          id: "PAR-FAM-03",
          fullName: "Kate Rafton",
          title: "Managing Partner",
          firmName: "Rafton Family Lawyers",
          isSpecialist: true,
          officeAddress: "Level 3, 17 Hunter St, Parramatta NSW 2150",
          coordinates: { lat: -33.8148, lng: 151.0012 },
          languages: ["English"],
          officialBio: "https://rafton.com.au/our-team/",
          assessment: "Leads the region's largest specialist family boutique; dual accredited.",
          seniorityTier: "Managing Partner"
        },
        {
          id: "PAR-FAM-04",
          fullName: "Jillian Morrison",
          title: "Principal Solicitor",
          firmName: "Mahony Family Lawyers",
          isSpecialist: false,
          officeAddress: "Suite 102, 3 Horwood Pl, Parramatta NSW 2150",
          coordinates: { lat: -33.8141, lng: 151.0038 },
          languages: ["English"],
          officialBio: "https://www.mahonylawyers.com.au/",
          assessment: "Renowned for compassionate, fixed-fee resolutions in complex separations.",
          seniorityTier: "Principal"
        },
        {
          id: "PAR-FAM-05",
          fullName: "Walid Kalouche",
          title: "Principal Director",
          firmName: "CK Lawyers",
          isSpecialist: false,
          officeAddress: "1-3 Marist Place, Parramatta NSW 2150",
          coordinates: { lat: -33.8115, lng: 151.0029 },
          languages: ["English", "Arabic"],
          officialBio: "https://www.cklawyers.com.au/family-law/",
          assessment: "Top-tier mediator and business/family crossover specialist.",
          seniorityTier: "Principal"
        }
      ],
      "Immigration Law": [
        {
          id: "PAR-IMM-21",
          fullName: "Michael Kah",
          title: "Principal Solicitor",
          firmName: "Kah Lawyers",
          isSpecialist: true,
          officeAddress: "Suite 2, Level 12, 150 George St, Parramatta NSW 2150",
          coordinates: { lat: -33.8128, lng: 151.0042 },
          languages: ["English"],
          officialBio: "https://kahlawyers.com/about-us/",
          assessment: "Accredited Specialist since 1998; peak veteran of visa litigation.",
          seniorityTier: "Principal"
        },
        {
          id: "PAR-IMM-22",
          fullName: "Nilesh Nandan",
          title: "Principal Lawyer",
          firmName: "MyVisa Lawyers",
          isSpecialist: true,
          officeAddress: "Level 14, 3 Horwood Pl, Parramatta NSW 2150",
          coordinates: { lat: -33.8141, lng: 151.0038 },
          languages: ["English", "Hindi"],
          officialBio: "https://myvisa.com.au/",
          assessment: "National authority on character cancellations and visa appeals.",
          seniorityTier: "Principal"
        },
        {
          id: "PAR-IMM-23",
          fullName: "Kashif Sultan",
          title: "Principal Solicitor",
          firmName: "Sultan Legal",
          isSpecialist: false,
          officeAddress: "Suite 2, Level 1, 48 George St, Parramatta NSW 2150",
          coordinates: { lat: -33.8139, lng: 151.0045 },
          languages: ["English", "Urdu", "Hindi", "Punjabi"],
          officialBio: "https://sultanlegal.com.au/kashif-sultan/",
          assessment: "Expert in South Asian business migration and complex tribunal matters.",
          seniorityTier: "Principal"
        }
      ],
      "Conveyancing": [
        {
          id: "PAR-CVY-41",
          fullName: "Dominic Maley",
          title: "Partner",
          firmName: "Maclarens Lawyers",
          isSpecialist: false,
          officeAddress: "232 Merrylands Road, Parramatta/Merrylands NSW 2160",
          coordinates: { lat: -33.8345, lng: 150.9921 },
          languages: ["English"],
          officialBio: "https://maclarens.com.au/services/727/property-conveyancing",
          assessment: "Leads high-volume residential and commercial development settlements.",
          seniorityTier: "Partner"
        },
        {
          id: "PAR-CVY-42",
          fullName: "Jeanette Limbo",
          title: "Conveyancing Practice Lead",
          firmName: "Matthews Folbigg",
          isSpecialist: false,
          officeAddress: "Level 7, 10-14 Smith St, Parramatta NSW 2150",
          coordinates: { lat: -33.8152, lng: 151.0041 },
          languages: ["English", "Tagalog"],
          officialBio: "https://www.matthewsfolbigg.com.au/our-people/",
          assessment: "Veteran lead for complex duplex and strata property transactions.",
          seniorityTier: "Associate Director"
        },
        {
          id: "PAR-CVY-43",
          fullName: "Marc Hardman",
          title: "Principal Solicitor",
          firmName: "Marc Hardman & Associates",
          isSpecialist: false,
          officeAddress: "Level 1, 11 Bridge St, Parramatta NSW 2150",
          coordinates: { lat: -33.8122, lng: 151.0025 },
          languages: ["English"],
          officialBio: "https://www.hardmanassociates.com.au/conveyancer-parramatta/",
          assessment: "40 years of local experience; the veteran choice for property law.",
          seniorityTier: "Principal"
        }
      ]
    };

    // Get all lawyers as flat array
    const getAllLawyers = () => {
      return Object.entries(LAWYERS_DATA).flatMap(([category, lawyers]) => 
        lawyers.map(l => ({ ...l, category }))
      );
    };

    // Default map center (Parramatta)
    const DEFAULT_CENTER = { lat: -33.8148, lng: 151.0030 };
    const DEFAULT_ZOOM = 15;

    // LocalStorage helpers
    const storage = {
      get: (key, defaultValue) => {
        try { return JSON.parse(localStorage.getItem(key)) || defaultValue; }
        catch { return defaultValue; }
      },
      set: (key, value) => {
        try { localStorage.setItem(key, JSON.stringify(value)); } catch {}
      },
      remove: (key) => {
        try { localStorage.removeItem(key); } catch {}
      }
    };

    // Create React element helper
    const h = React.createElement;

    // Icon component using Lucide
    function Icon({ name, size = 20, className = '', strokeWidth = 2 }) {
      const ref = React.useRef(null);
      React.useEffect(() => {
        if (ref.current && lucide.icons[name]) {
          ref.current.innerHTML = '';
          const svg = lucide.icons[name].toSvg({ width: size, height: size, 'stroke-width': strokeWidth });
          ref.current.innerHTML = svg;
        }
      }, [name, size, strokeWidth]);
      return h('span', { ref, className: `inline-flex items-center justify-center ${className}` });
    }

    // ============================================
    // HEADER COMPONENT (Original repo style logo)
    // ============================================
    function Header({ user, onLoginClick, onShortlistClick, onAboutClick, onLogoClick }) {
      return h('header', { className: 'bg-white/95 backdrop-blur-md border-b border-slate-200 sticky top-0 z-50' },
        h('div', { className: 'max-w-7xl mx-auto px-4 sm:px-6 lg:px-8' },
          h('div', { className: 'flex items-center justify-between h-16' },
            // Logo - Original repo style
            h('button', { 
              onClick: onLogoClick,
              className: 'flex items-center gap-2 group',
              'aria-label': 'LegalConnect Home'
            },
              h('div', { className: 'w-10 h-10 logo-icon rounded-xl flex items-center justify-center shadow-lg group-hover:shadow-xl transition-shadow' },
                h(Icon, { name: 'scale', size: 22, className: 'text-white' })
              ),
              h('div', { className: 'hidden sm:block' },
                h('span', { className: 'font-display text-xl font-bold text-navy-900' },
                  'Legal',
                  h('span', { className: 'text-primary-600' }, 'Connect')
                ),
                h('p', { className: 'text-xs text-slate-500 -mt-1' }, 'Find Your Legal Expert')
              )
            ),
            // Navigation
            h('nav', { className: 'flex items-center gap-1 sm:gap-2' },
              // About Link
              h('button', {
                onClick: onAboutClick,
                className: 'px-3 py-2 text-sm font-medium text-slate-600 hover:text-primary-600 transition-colors rounded-lg hover:bg-gray-100'
              }, 'About'),
              // Shortlist
              h('button', {
                onClick: onShortlistClick,
                className: 'flex items-center gap-1.5 px-3 py-2 text-sm font-medium text-slate-600 hover:text-primary-600 transition-colors rounded-lg hover:bg-gray-100'
              },
                h(Icon, { name: 'heart', size: 16 }),
                h('span', { className: 'hidden sm:inline' }, 'Shortlist')
              ),
              // Login/Sign Up or User Menu
              user ? 
                h('div', { className: 'flex items-center gap-2' },
                  h('span', { className: 'text-sm text-slate-600 hidden sm:inline' }, user.name),
                  h('button', {
                    onClick: onLoginClick,
                    className: 'flex items-center gap-1.5 px-3 py-2 text-sm font-medium text-slate-600 hover:text-primary-600 transition-colors rounded-lg hover:bg-gray-100'
                  },
                    h(Icon, { name: 'log-out', size: 16 }),
                    h('span', { className: 'hidden sm:inline' }, 'Logout')
                  )
                ) :
                h('button', {
                  onClick: onLoginClick,
                  className: 'flex items-center gap-1.5 px-4 py-2 bg-primary-600 text-white text-sm font-semibold rounded-lg hover:bg-primary-700 transition-colors'
                },
                  h(Icon, { name: 'log-in', size: 16 }),
                  h('span', null, 'Login')
                )
            )
          )
        )
      );
    }

    // ============================================
    // HERO SECTION COMPONENT (Integrated with filters)
    // ============================================
    function HeroSection({ activeCategory, onCategoryChange, showOtherMessage }) {
      const categories = [
        { id: 'Family Law', label: 'Family & Divorce' },
        { id: 'Conveyancing', label: 'Property & Buying' },
        { id: 'Immigration Law', label: 'Visas & Migration' },
        { id: 'other', label: 'Other' }
      ];

      const handleCategoryClick = (catId) => {
        onCategoryChange(catId);
        // Scroll to browse section if not "other"
        if (catId !== 'other') {
          setTimeout(() => {
            const browseSection = document.getElementById('browse');
            if (browseSection) {
              browseSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
          }, 100);
        }
      };

      return h('section', { className: 'hero-gradient py-12 sm:py-16' },
        h('div', { className: 'max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center' },
          // Main Heading
          h('h1', { className: 'text-3xl sm:text-4xl lg:text-5xl font-display font-bold text-white mb-4' },
            'Find Your Perfect ',
            h('span', { className: 'text-gold' }, 'Legal Match')
          ),
          // Subtitle
          h('p', { className: 'text-base sm:text-lg text-gray-300 mb-3 max-w-2xl mx-auto' },
            "Answer a few quick questions and we'll match you with the perfect legal practitioner"
          ),
          // Location badge
          h('div', { className: 'inline-flex items-center gap-2 px-4 py-2 bg-white/10 rounded-full text-sm text-gray-300 mb-8' },
            h(Icon, { name: 'map-pin', size: 14, className: 'text-gold' }),
            h('span', null, 'Currently serving '),
            h('span', { className: 'font-semibold text-white' }, 'Western Sydney'),
            h('span', null, ' â€¢ Expanding soon!')
          ),
          // Category Selection Card
          h('div', { className: 'glass-card rounded-2xl p-6 sm:p-8 max-w-2xl mx-auto' },
            // Decorative line
            h('div', { className: 'w-20 h-0.5 bg-gray-600 mx-auto mb-6 rounded-full' }),
            // Question
            h('h2', { className: 'text-xl sm:text-2xl font-display text-white mb-6' },
              'I am looking for legal assistance with...'
            ),
            // Category Buttons
            h('div', { className: 'flex flex-wrap justify-center gap-3' },
              categories.map(cat => 
                h('button', {
                  key: cat.id,
                  onClick: () => handleCategoryClick(cat.id),
                  className: `category-pill px-5 py-2.5 rounded-full text-sm font-semibold transition-all ${
                    activeCategory === cat.id 
                      ? 'active' 
                      : 'bg-white text-navy-900 hover:bg-gold'
                  }`
                },
                  cat.label
                )
              )
            ),
            // "Other" message
            showOtherMessage && h('div', { className: 'mt-6 p-4 bg-amber-500/20 border border-amber-500/30 rounded-xl' },
              h('p', { className: 'text-amber-200 font-medium' },
                'ðŸš§ Other practice areas coming soon! We\'re expanding our network.'
              )
            )
          )
        )
      );
    }

    // ============================================
    // ABOUT PAGE COMPONENT (with Header and Footer)
    // ============================================
    function AboutPage({ user, onLoginClick, onShortlistClick, onGoHome }) {
      return h('div', { className: 'min-h-screen flex flex-col bg-gray-50' },
        // Header
        h(Header, {
          user,
          onLoginClick,
          onShortlistClick,
          onAboutClick: () => {}, // Already on about page
          onLogoClick: onGoHome
        }),
        // Content
        h('main', { className: 'flex-1' },
          h('div', { className: 'max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8' },
            // Page title
            h('h1', { className: 'text-3xl font-display font-bold text-gray-900 mb-8' }, 'About LegalConnect'),
            
            // Hero section
            h('div', { className: 'bg-navy-900 rounded-2xl p-8 mb-8 text-white text-center' },
              h('div', { className: 'w-16 h-16 logo-icon rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg' },
                h(Icon, { name: 'scale', size: 32, className: 'text-white' })
              ),
              h('h2', { className: 'text-2xl font-display font-bold mb-2' }, 
                'Legal',
                h('span', { className: 'text-primary-400' }, 'Connect')
              ),
              h('p', { className: 'text-gray-300' }, 'Connecting Western Sydney with trusted legal professionals')
            ),
            
            // Mission
            h('div', { className: 'bg-white rounded-xl border border-gray-200 p-6 mb-6' },
              h('h3', { className: 'text-lg font-semibold text-gray-900 mb-3 flex items-center gap-2' },
                h(Icon, { name: 'target', size: 20, className: 'text-primary-600' }),
                'Our Mission'
              ),
              h('p', { className: 'text-gray-600 leading-relaxed' },
                'LegalConnect was created to simplify the process of finding quality legal representation in Western Sydney. We understand that navigating the legal system can be overwhelming, and finding the right lawyer shouldn\'t add to that stress. Our platform connects you with verified, experienced legal professionals who specialise in your specific needs.'
              )
            ),
            
            // What We Do
            h('div', { className: 'bg-white rounded-xl border border-gray-200 p-6 mb-6' },
              h('h3', { className: 'text-lg font-semibold text-gray-900 mb-3 flex items-center gap-2' },
                h(Icon, { name: 'briefcase', size: 20, className: 'text-primary-600' }),
                'What We Do'
              ),
              h('p', { className: 'text-gray-600 leading-relaxed mb-4' },
                'We\'ve curated a directory of the top legal practitioners in the Parramatta area, covering three key practice areas:'
              ),
              h('div', { className: 'grid grid-cols-1 md:grid-cols-3 gap-4' },
                h('div', { className: 'bg-primary-50 rounded-lg p-4' },
                  h('div', { className: 'flex items-center gap-2 mb-2' },
                    h(Icon, { name: 'users', size: 18, className: 'text-primary-600' }),
                    h('span', { className: 'font-semibold text-primary-900' }, 'Family Law')
                  ),
                  h('p', { className: 'text-sm text-primary-700' }, 'Divorce, custody, property settlements, and family disputes')
                ),
                h('div', { className: 'bg-green-50 rounded-lg p-4' },
                  h('div', { className: 'flex items-center gap-2 mb-2' },
                    h(Icon, { name: 'home', size: 18, className: 'text-green-600' }),
                    h('span', { className: 'font-semibold text-green-900' }, 'Conveyancing')
                  ),
                  h('p', { className: 'text-sm text-green-700' }, 'Property purchases, sales, transfers and settlements')
                ),
                h('div', { className: 'bg-amber-50 rounded-lg p-4' },
                  h('div', { className: 'flex items-center gap-2 mb-2' },
                    h(Icon, { name: 'plane', size: 18, className: 'text-amber-600' }),
                    h('span', { className: 'font-semibold text-amber-900' }, 'Immigration')
                  ),
                  h('p', { className: 'text-sm text-amber-700' }, 'Visas, citizenship applications, appeals and migration advice')
                )
              )
            ),
            
            // How It Works
            h('div', { className: 'bg-white rounded-xl border border-gray-200 p-6 mb-6' },
              h('h3', { className: 'text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2' },
                h(Icon, { name: 'list-ordered', size: 20, className: 'text-primary-600' }),
                'How It Works'
              ),
              h('div', { className: 'space-y-4' },
                [
                  { num: '1', title: 'Select Your Need', desc: 'Choose the type of legal assistance you require from our categories.' },
                  { num: '2', title: 'Browse Lawyers', desc: 'View profiles, credentials, and assessments of qualified lawyers in your area.' },
                  { num: '3', title: 'Save to Shortlist', desc: 'Create an account to save lawyers you\'re interested in for easy comparison.' },
                  { num: '4', title: 'Make Contact', desc: 'Visit the lawyer\'s official profile to get in touch directly.' }
                ].map(step => 
                  h('div', { key: step.num, className: 'flex gap-4' },
                    h('div', { className: 'w-8 h-8 bg-navy-900 text-white rounded-full flex items-center justify-center flex-shrink-0 font-semibold text-sm' }, step.num),
                    h('div', null,
                      h('h4', { className: 'font-medium text-gray-900' }, step.title),
                      h('p', { className: 'text-sm text-gray-600' }, step.desc)
                    )
                  )
                )
              )
            ),
            
            // Coverage Area
            h('div', { className: 'bg-white rounded-xl border border-gray-200 p-6 mb-6' },
              h('h3', { className: 'text-lg font-semibold text-gray-900 mb-3 flex items-center gap-2' },
                h(Icon, { name: 'map', size: 20, className: 'text-primary-600' }),
                'Coverage Area'
              ),
              h('p', { className: 'text-gray-600 leading-relaxed mb-3' },
                'LegalConnect currently focuses on the Parramatta CBD and surrounding Western Sydney suburbs. We\'re working to expand our coverage to include more areas across New South Wales.'
              ),
              h('div', { className: 'bg-gold/10 border border-gold/30 rounded-lg p-4' },
                h('p', { className: 'text-sm text-amber-800 flex items-center gap-2' },
                  h(Icon, { name: 'info', size: 16 }),
                  'More suburbs and practice areas coming soon!'
                )
              )
            ),
            
            // Disclaimer
            h('div', { className: 'bg-gray-100 rounded-xl p-6' },
              h('h3', { className: 'text-lg font-semibold text-gray-900 mb-3 flex items-center gap-2' },
                h(Icon, { name: 'alert-triangle', size: 20, className: 'text-amber-600' }),
                'Important Disclaimer'
              ),
              h('p', { className: 'text-sm text-gray-600 leading-relaxed' },
                'LegalConnect is a directory service only and does not provide legal advice. The information provided on this platform is for general informational purposes only and should not be construed as legal advice on any matter. We do not endorse or recommend any particular lawyer. Users should independently verify credentials and qualifications before engaging any legal professional. Always seek appropriate professional advice for your specific circumstances.'
              )
            )
          )
        ),
        // Footer
        h(Footer, { onPrivacyClick: null, onTermsClick: null, onDisclaimerClick: null, onContactClick: null })
      );
    }

    // ============================================
    // FOOTER COMPONENT (with Privacy, Terms, Disclaimer)
    // ============================================
    function Footer({ onPrivacyClick, onTermsClick, onDisclaimerClick, onContactClick }) {
      return h('footer', { className: 'bg-navy-900 text-white' },
        h('div', { className: 'max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10' },
          h('div', { className: 'grid grid-cols-1 md:grid-cols-4 gap-8' },
            // Brand - Updated to match original repo
            h('div', null,
              h('div', { className: 'flex items-center gap-2 mb-4' },
                h('div', { className: 'w-10 h-10 logo-icon rounded-xl flex items-center justify-center shadow-lg' },
                  h(Icon, { name: 'scale', size: 20, className: 'text-white' })
                ),
                h('div', null,
                  h('span', { className: 'font-display text-lg font-bold' },
                    'Legal',
                    h('span', { className: 'text-primary-400' }, 'Connect')
                  )
                )
              ),
              h('p', { className: 'text-gray-400 text-sm leading-relaxed' },
                'Find qualified legal professionals in Western Sydney. Compare lawyers and make informed decisions about your legal representation.'
              )
            ),
            // Practice Areas
            h('div', null,
              h('h4', { className: 'font-semibold mb-4 text-gold' }, 'Practice Areas'),
              h('ul', { className: 'space-y-2 text-sm text-gray-400' },
                h('li', null, h('span', { className: 'hover:text-white transition-colors cursor-default' }, 'Family Law')),
                h('li', null, h('span', { className: 'hover:text-white transition-colors cursor-default' }, 'Immigration Law')),
                h('li', null, h('span', { className: 'hover:text-white transition-colors cursor-default' }, 'Conveyancing'))
              )
            ),
            // Legal & Contact
            h('div', null,
              h('h4', { className: 'font-semibold mb-4 text-gold' }, 'Legal'),
              h('ul', { className: 'space-y-2 text-sm text-gray-400' },
                h('li', null, h('button', { onClick: onPrivacyClick, className: 'hover:text-white transition-colors' }, 'Privacy Policy')),
                h('li', null, h('button', { onClick: onTermsClick, className: 'hover:text-white transition-colors' }, 'Terms of Use')),
                h('li', null, h('button', { onClick: onDisclaimerClick, className: 'hover:text-white transition-colors' }, 'Disclaimer')),
                h('li', { className: 'pt-2' }, h('button', { onClick: onContactClick, className: 'hover:text-white transition-colors flex items-center gap-1' }, 
                  h(Icon, { name: 'mail', size: 14 }),
                  'Contact Us'
                ))
              )
            ),
            // Resources
            h('div', null,
              h('h4', { className: 'font-semibold mb-4 text-gold' }, 'Resources'),
              h('ul', { className: 'space-y-2 text-sm text-gray-400' },
                h('li', null, h('a', { href: 'https://www.lawsociety.com.au/', target: '_blank', rel: 'noopener noreferrer', className: 'hover:text-white transition-colors' }, 'Law Society NSW')),
                h('li', null, h('a', { href: 'https://www.mara.gov.au/', target: '_blank', rel: 'noopener noreferrer', className: 'hover:text-white transition-colors' }, 'MARA Registry')),
                h('li', null, h('a', { href: 'https://www.familycourt.gov.au/', target: '_blank', rel: 'noopener noreferrer', className: 'hover:text-white transition-colors' }, 'Family Court of Australia'))
              )
            )
          ),
          // Disclaimer
          h('div', { className: 'mt-8 pt-6 border-t border-gray-700' },
            h('p', { className: 'text-xs text-gray-500 leading-relaxed' },
              'Disclaimer: LegalConnect is a directory service only and does not provide legal advice. The information provided is for general purposes only and should not be construed as legal advice. Always verify credentials directly with the legal professional before engaging their services.'
            )
          ),
          // Copyright
          h('div', { className: 'mt-4 text-center text-sm text-gray-500' },
            `Â© ${new Date().getFullYear()} LegalConnect. All rights reserved.`
          )
        )
      );
    }

    // ============================================
    // LEGAL PAGE COMPONENT (Privacy, Terms, Disclaimer)
    // ============================================
    function LegalPage({ pageType, user, onLoginClick, onShortlistClick, onAboutClick, onGoHome }) {
      const content = {
        privacy: {
          title: 'Privacy Policy',
          sections: [
            {
              heading: 'Information We Collect',
              text: 'LegalConnect collects limited personal information when you create an account, including your name and email address. We also collect usage data such as pages visited and features used to improve our service.'
            },
            {
              heading: 'How We Use Your Information',
              text: 'We use your information to provide and improve our services, maintain your shortlist, and communicate important updates. We do not sell or share your personal information with third parties for marketing purposes.'
            },
            {
              heading: 'Data Storage and Security',
              text: 'Your data is stored securely using industry-standard encryption. Your shortlist and preferences are stored locally in your browser and optionally synced to our secure servers when you create an account.'
            },
            {
              heading: 'Cookies',
              text: 'We use essential cookies to maintain your session and preferences. We do not use tracking cookies for advertising purposes.'
            },
            {
              heading: 'Your Rights',
              text: 'You have the right to access, correct, or delete your personal information at any time. Contact us to exercise these rights or if you have any privacy-related concerns.'
            }
          ]
        },
        terms: {
          title: 'Terms of Use',
          sections: [
            {
              heading: 'Acceptance of Terms',
              text: 'By accessing and using LegalConnect, you accept and agree to be bound by these Terms of Use. If you do not agree to these terms, please do not use our service.'
            },
            {
              heading: 'Service Description',
              text: 'LegalConnect is a directory service that helps users find legal professionals in Western Sydney. We provide information about lawyers but do not provide legal advice or services directly.'
            },
            {
              heading: 'User Accounts',
              text: 'You are responsible for maintaining the confidentiality of your account credentials and for all activities that occur under your account. You must provide accurate information when creating an account.'
            },
            {
              heading: 'Acceptable Use',
              text: 'You agree to use LegalConnect only for lawful purposes. You may not use our service to harass lawyers, submit false information, or engage in any activity that could harm our platform or users.'
            },
            {
              heading: 'Intellectual Property',
              text: 'All content on LegalConnect, including text, graphics, logos, and software, is the property of LegalConnect or its licensors and is protected by intellectual property laws.'
            },
            {
              heading: 'Limitation of Liability',
              text: 'LegalConnect is provided "as is" without warranties of any kind. We are not liable for any damages arising from your use of our service or your interactions with lawyers found through our platform.'
            }
          ]
        },
        disclaimer: {
          title: 'Disclaimer',
          sections: [
            {
              heading: 'Directory Service Only',
              text: 'LegalConnect is a directory service only. We do not provide legal advice, representation, or services. Any information on this platform is for general informational purposes only.'
            },
            {
              heading: 'No Legal Advice',
              text: 'Nothing on LegalConnect constitutes legal advice. The information provided should not be relied upon as a substitute for professional legal counsel tailored to your specific situation.'
            },
            {
              heading: 'No Endorsement',
              text: 'Listing on LegalConnect does not constitute an endorsement or recommendation of any lawyer. We do not verify the accuracy of information provided by lawyers and make no representations about their qualifications or competence.'
            },
            {
              heading: 'User Responsibility',
              text: 'Users are solely responsible for selecting a lawyer and should independently verify credentials, qualifications, and suitability before engaging any legal professional.'
            },
            {
              heading: 'Third-Party Links',
              text: 'LegalConnect may contain links to external websites. We are not responsible for the content, accuracy, or practices of third-party sites.'
            },
            {
              heading: 'Changes to Information',
              text: 'Information about lawyers, including contact details and practice areas, may change without notice. We strive to keep information current but cannot guarantee its accuracy at all times.'
            }
          ]
        }
      };

      const page = content[pageType];

      return h('div', { className: 'min-h-screen flex flex-col bg-gray-50' },
        h(Header, {
          user,
          onLoginClick,
          onShortlistClick,
          onAboutClick,
          onLogoClick: onGoHome
        }),
        h('main', { className: 'flex-1' },
          h('div', { className: 'max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8' },
            h('h1', { className: 'text-3xl font-display font-bold text-gray-900 mb-8' }, page.title),
            h('div', { className: 'space-y-6' },
              page.sections.map((section, idx) => 
                h('div', { key: idx, className: 'bg-white rounded-xl border border-gray-200 p-6' },
                  h('h3', { className: 'text-lg font-semibold text-gray-900 mb-3' }, section.heading),
                  h('p', { className: 'text-gray-600 leading-relaxed' }, section.text)
                )
              )
            ),
            h('div', { className: 'mt-8 text-sm text-gray-500' },
              h('p', null, 'Last updated: January 2026'),
              h('p', { className: 'mt-2' }, 'If you have any questions about this policy, please contact us.')
            )
          )
        ),
        h(Footer, { onPrivacyClick: null, onTermsClick: null, onDisclaimerClick: null, onContactClick: null })
      );
    }

    // ============================================
    // LOGIN MODAL COMPONENT (HIGH Z-INDEX)
    // ============================================
    function LoginModal({ isOpen, onClose, onLogin, onSignup }) {
      const [mode, setMode] = React.useState('login');
      const [email, setEmail] = React.useState('');
      const [password, setPassword] = React.useState('');
      const [name, setName] = React.useState('');
      const [error, setError] = React.useState('');

      React.useEffect(() => {
        if (isOpen) {
          setEmail('');
          setPassword('');
          setName('');
          setError('');
          setMode('login');
        }
      }, [isOpen]);

      if (!isOpen) return null;

      const handleSubmit = (e) => {
        e.preventDefault();
        setError('');
        
        if (!email || !password) {
          setError('Please fill in all fields');
          return;
        }
        
        if (mode === 'signup' && !name) {
          setError('Please enter your name');
          return;
        }

        if (mode === 'login') {
          onLogin({ email, name: email.split('@')[0] });
        } else {
          onSignup({ email, name, password });
        }
        onClose();
      };

      return h('div', { 
        className: 'fixed inset-0 bg-black/60 modal-backdrop flex items-center justify-center p-4',
        style: { zIndex: 10000 },
        onClick: (e) => e.target === e.currentTarget && onClose()
      },
        h('div', { 
          className: 'bg-white rounded-2xl shadow-2xl max-w-md w-full p-8 modal-content',
          style: { zIndex: 10001 }
        },
          h('div', { className: 'flex items-center justify-between mb-6' },
            h('h2', { className: 'text-2xl font-display font-bold text-gray-900' }, 
              mode === 'login' ? 'Welcome Back' : 'Create Account'
            ),
            h('button', { 
              onClick: onClose, 
              className: 'p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-100',
              'aria-label': 'Close'
            }, h(Icon, { name: 'x', size: 20 }))
          ),
          h('form', { onSubmit: handleSubmit, className: 'space-y-4' },
            mode === 'signup' && h('div', null,
              h('label', { className: 'block text-sm font-medium text-gray-700 mb-1' }, 'Full Name'),
              h('input', {
                type: 'text',
                value: name,
                onChange: (e) => setName(e.target.value),
                className: 'w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-transparent',
                placeholder: 'John Smith'
              })
            ),
            h('div', null,
              h('label', { className: 'block text-sm font-medium text-gray-700 mb-1' }, 'Email'),
              h('input', {
                type: 'email',
                value: email,
                onChange: (e) => setEmail(e.target.value),
                className: 'w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-transparent',
                placeholder: 'you@example.com'
              })
            ),
            h('div', null,
              h('label', { className: 'block text-sm font-medium text-gray-700 mb-1' }, 'Password'),
              h('input', {
                type: 'password',
                value: password,
                onChange: (e) => setPassword(e.target.value),
                className: 'w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-transparent',
                placeholder: 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢'
              })
            ),
            error && h('p', { className: 'text-sm text-red-600' }, error),
            h('button', {
              type: 'submit',
              className: 'w-full py-3 bg-primary-600 text-white font-semibold rounded-xl hover:bg-primary-700 transition-colors'
            }, mode === 'login' ? 'Log In' : 'Sign Up'),
            h('p', { className: 'text-center text-sm text-gray-600' },
              mode === 'login' ? "Don't have an account? " : "Already have an account? ",
              h('button', {
                type: 'button',
                onClick: () => { setMode(mode === 'login' ? 'signup' : 'login'); setError(''); },
                className: 'text-primary-600 font-medium hover:underline'
              }, mode === 'login' ? 'Sign up' : 'Log in')
            )
          )
        )
      );
    }

    // ============================================
    // SHORTLIST PROMPT MODAL (HIGH Z-INDEX)
    // ============================================
    function ShortlistPromptModal({ isOpen, onClose, onLogin }) {
      if (!isOpen) return null;

      return h('div', { 
        className: 'fixed inset-0 bg-black/60 modal-backdrop flex items-center justify-center p-4',
        style: { zIndex: 10000 },
        onClick: (e) => e.target === e.currentTarget && onClose()
      },
        h('div', { 
          className: 'bg-white rounded-2xl shadow-2xl max-w-sm w-full p-8 text-center modal-content',
          style: { zIndex: 10001 }
        },
          h('div', { className: 'w-16 h-16 bg-primary-100 rounded-full flex items-center justify-center mx-auto mb-4' },
            h(Icon, { name: 'heart', size: 28, className: 'text-primary-600' })
          ),
          h('h3', { className: 'text-xl font-display font-bold text-gray-900 mb-2' }, 'Save Your Shortlist'),
          h('p', { className: 'text-gray-600 mb-2' },
            'Create a free account to save and manage your shortlist of lawyers.'
          ),
          h('p', { className: 'text-sm text-gray-500 mb-6' },
            'Sign up takes less than a minute!'
          ),
          h('div', { className: 'flex gap-3' },
            h('button', {
              onClick: onClose,
              className: 'flex-1 py-3 border border-gray-300 text-gray-700 font-medium rounded-xl hover:bg-gray-50 transition-colors'
            }, 'Cancel'),
            h('button', {
              onClick: onLogin,
              className: 'flex-1 py-3 bg-primary-600 text-white font-semibold rounded-xl hover:bg-primary-700 transition-colors'
            }, 'Login / Sign Up')
          )
        )
      );
    }

    // ============================================
    // CONTACT US MODAL COMPONENT
    // ============================================
    function ContactModal({ isOpen, onClose }) {
      const [name, setName] = React.useState('');
      const [email, setEmail] = React.useState('');
      const [message, setMessage] = React.useState('');
      const [isSubmitted, setIsSubmitted] = React.useState(false);
      const [isSubmitting, setIsSubmitting] = React.useState(false);
      const [error, setError] = React.useState('');

      React.useEffect(() => {
        if (isOpen) {
          setName('');
          setEmail('');
          setMessage('');
          setIsSubmitted(false);
          setError('');
        }
      }, [isOpen]);

      if (!isOpen) return null;

      const handleSubmit = async (e) => {
        e.preventDefault();
        setError('');
        
        if (!name || !email || !message) {
          setError('Please fill in all fields');
          return;
        }

        // Email validation
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
          setError('Please enter a valid email address');
          return;
        }

        setIsSubmitting(true);
        
        // Send email using mailto (opens email client) or FormSubmit service
        // Using FormSubmit.co for serverless form handling
        try {
          const response = await fetch('https://formsubmit.co/ajax/spin291@gmail.com', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Accept': 'application/json'
            },
            body: JSON.stringify({
              name: name,
              email: email,
              message: message,
              _subject: 'LegalConnect Contact Form Submission'
            })
          });
          
          if (response.ok) {
            setIsSubmitted(true);
          } else {
            // Fallback: open mailto link
            const mailtoLink = `mailto:spin291@gmail.com?subject=LegalConnect Contact Form&body=Name: ${encodeURIComponent(name)}%0D%0AEmail: ${encodeURIComponent(email)}%0D%0A%0D%0AMessage:%0D%0A${encodeURIComponent(message)}`;
            window.open(mailtoLink, '_blank');
            setIsSubmitted(true);
          }
        } catch (err) {
          // Fallback: open mailto link
          const mailtoLink = `mailto:spin291@gmail.com?subject=LegalConnect Contact Form&body=Name: ${encodeURIComponent(name)}%0D%0AEmail: ${encodeURIComponent(email)}%0D%0A%0D%0AMessage:%0D%0A${encodeURIComponent(message)}`;
          window.open(mailtoLink, '_blank');
          setIsSubmitted(true);
        }
        
        setIsSubmitting(false);
      };

      // Success state
      if (isSubmitted) {
        return h('div', { 
          className: 'fixed inset-0 bg-black/60 modal-backdrop flex items-center justify-center p-4',
          style: { zIndex: 10000 },
          onClick: (e) => e.target === e.currentTarget && onClose()
        },
          h('div', { 
            className: 'bg-white rounded-2xl shadow-2xl max-w-md w-full p-8 text-center modal-content',
            style: { zIndex: 10001 }
          },
            h('div', { className: 'w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4' },
              h(Icon, { name: 'circle-check', size: 32, className: 'text-green-600' })
            ),
            h('h3', { className: 'text-xl font-display font-bold text-gray-900 mb-3' }, 'Message Sent!'),
            h('p', { className: 'text-gray-600 mb-6' },
              'Thank you for your message, a member of the team will be in touch!'
            ),
            h('button', {
              onClick: onClose,
              className: 'w-full py-3 bg-primary-600 text-white font-semibold rounded-xl hover:bg-primary-700 transition-colors'
            }, 'Close')
          )
        );
      }

      // Form state
      return h('div', { 
        className: 'fixed inset-0 bg-black/60 modal-backdrop flex items-center justify-center p-4',
        style: { zIndex: 10000 },
        onClick: (e) => e.target === e.currentTarget && onClose()
      },
        h('div', { 
          className: 'bg-white rounded-2xl shadow-2xl max-w-md w-full p-8 modal-content',
          style: { zIndex: 10001 }
        },
          h('div', { className: 'flex items-center justify-between mb-6' },
            h('h2', { className: 'text-2xl font-display font-bold text-gray-900' }, 'Contact Us'),
            h('button', { 
              onClick: onClose, 
              className: 'p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-100',
              'aria-label': 'Close'
            }, h(Icon, { name: 'x', size: 20 }))
          ),
          h('p', { className: 'text-gray-600 mb-6' },
            'Have a question or feedback? We\'d love to hear from you.'
          ),
          h('form', { onSubmit: handleSubmit, className: 'space-y-4' },
            h('div', null,
              h('label', { className: 'block text-sm font-medium text-gray-700 mb-1' }, 'Your Name'),
              h('input', {
                type: 'text',
                value: name,
                onChange: (e) => setName(e.target.value),
                className: 'w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-transparent',
                placeholder: 'John Smith'
              })
            ),
            h('div', null,
              h('label', { className: 'block text-sm font-medium text-gray-700 mb-1' }, 'Email Address'),
              h('input', {
                type: 'email',
                value: email,
                onChange: (e) => setEmail(e.target.value),
                className: 'w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-transparent',
                placeholder: 'you@example.com'
              })
            ),
            h('div', null,
              h('label', { className: 'block text-sm font-medium text-gray-700 mb-1' }, 'Message'),
              h('textarea', {
                value: message,
                onChange: (e) => setMessage(e.target.value),
                rows: 4,
                className: 'w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-transparent resize-none',
                placeholder: 'How can we help you?'
              })
            ),
            error && h('p', { className: 'text-sm text-red-600' }, error),
            h('button', {
              type: 'submit',
              disabled: isSubmitting,
              className: `w-full py-3 bg-primary-600 text-white font-semibold rounded-xl hover:bg-primary-700 transition-colors ${isSubmitting ? 'opacity-50 cursor-not-allowed' : ''}`
            }, isSubmitting ? 'Sending...' : 'Send Message')
          )
        )
      );
    }

    // ============================================
    // LAWYER CARD COMPONENT
    // ============================================
    function LawyerCard({ lawyer, isActive, onAddToShortlist, isShortlisted, user, onCardClick }) {
      const { fullName, title, firmName, isSpecialist, officeAddress, languages, officialBio, assessment, seniorityTier, category } = lawyer;

      return h('article', {
        'data-lawyer-id': lawyer.id,
        className: `lawyer-card bg-white rounded-xl border-2 p-5 transition-all cursor-pointer ${isActive ? 'active border-primary-500' : 'border-gray-200 hover:border-gray-300'}`,
        onClick: () => onCardClick && onCardClick(lawyer)
      },
        // Header
        h('div', { className: 'flex items-start justify-between gap-4 mb-3' },
          h('div', { className: 'flex-1 min-w-0' },
            h('div', { className: 'flex items-center gap-2 mb-1 flex-wrap' },
              h('h3', { className: 'text-lg font-semibold text-gray-900' }, fullName),
              isSpecialist && h('span', { 
                className: 'px-2 py-0.5 bg-amber-100 text-amber-800 text-xs font-medium rounded',
                title: 'Accredited Specialist'
              }, 'Specialist')
            ),
            h('p', { className: 'text-sm text-gray-600' }, title),
            h('p', { className: 'text-sm font-medium text-primary-600' }, firmName)
          )
        ),
        // Category & Seniority
        h('div', { className: 'flex flex-wrap gap-2 mb-3' },
          h('span', { className: 'px-2.5 py-1 bg-primary-50 text-primary-700 text-xs font-medium rounded-full' }, category),
          h('span', { className: 'px-2.5 py-1 bg-gray-100 text-gray-600 text-xs font-medium rounded-full' }, seniorityTier)
        ),
        // Assessment
        h('p', { className: 'text-sm text-gray-700 mb-3' }, assessment),
        // Address
        h('div', { className: 'flex items-start gap-2 text-sm text-gray-500 mb-3' },
          h(Icon, { name: 'map-pin', size: 14, className: 'mt-0.5 flex-shrink-0' }),
          h('span', null, officeAddress)
        ),
        // Languages
        languages.length > 1 && h('div', { className: 'flex items-center gap-2 text-sm text-gray-500 mb-4' },
          h(Icon, { name: 'languages', size: 14, className: 'flex-shrink-0' }),
          h('span', null, languages.join(', '))
        ),
        // Actions - Two buttons side by side
        h('div', { className: 'flex gap-2 pt-3 border-t border-gray-100' },
          h('a', {
            href: officialBio,
            target: '_blank',
            rel: 'noopener noreferrer',
            className: 'flex-1 flex items-center justify-center gap-1.5 px-3 py-2.5 bg-primary-600 text-white text-sm font-medium rounded-lg hover:bg-primary-700 transition-colors'
          },
            h(Icon, { name: 'external-link', size: 14 }),
            'View Profile'
          ),
          h('button', {
            onClick: () => onAddToShortlist(lawyer),
            className: `flex-1 flex items-center justify-center gap-1.5 px-3 py-2.5 text-sm font-medium rounded-lg transition-colors ${
              isShortlisted 
                ? 'bg-red-50 text-red-600 border border-red-200 hover:bg-red-100' 
                : 'bg-gray-100 text-gray-700 border border-gray-200 hover:bg-gray-200'
            }`,
            title: !user ? 'Sign up to save to shortlist' : (isShortlisted ? 'Remove from shortlist' : 'Add to shortlist')
          },
            h(Icon, { name: 'heart', size: 14 }),
            isShortlisted ? 'Saved' : 'Shortlist'
          )
        )
      );
    }

    // ============================================
    // LAWYER LIST (with Intersection Observer)
    // ============================================
    function LawyerList({ lawyers, activeLawyerId, onActiveLawyerChange, onAddToShortlist, shortlist, user, onCardClick }) {
      const listRef = React.useRef(null);
      const observerRef = React.useRef(null);

      React.useEffect(() => {
        if (!listRef.current) return;

        const options = {
          root: listRef.current,
          rootMargin: '-40% 0px -40% 0px',
          threshold: 0
        };

        observerRef.current = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              const lawyerId = entry.target.dataset.lawyerId;
              if (lawyerId) {
                onActiveLawyerChange(lawyerId);
              }
            }
          });
        }, options);

        const cards = listRef.current.querySelectorAll('[data-lawyer-id]');
        cards.forEach(card => observerRef.current.observe(card));

        return () => {
          if (observerRef.current) {
            observerRef.current.disconnect();
          }
        };
      }, [lawyers, onActiveLawyerChange]);

      const isShortlisted = (id) => shortlist.some(l => l.id === id);

      return h('div', { 
        ref: listRef,
        className: 'h-full overflow-y-auto space-y-4 p-4',
        role: 'list',
        'aria-label': 'Lawyer listings'
      },
        lawyers.length === 0 ?
          h('div', { className: 'flex flex-col items-center justify-center h-64 text-center' },
            h(Icon, { name: 'search', size: 48, className: 'text-gray-300 mb-4' }),
            h('h3', { className: 'text-lg font-medium text-gray-900 mb-1' }, 'No lawyers found'),
            h('p', { className: 'text-gray-500' }, 'Try selecting a different category')
          ) :
          lawyers.map(lawyer => 
            h(LawyerCard, {
              key: lawyer.id,
              lawyer,
              isActive: lawyer.id === activeLawyerId,
              onAddToShortlist,
              isShortlisted: isShortlisted(lawyer.id),
              user,
              onCardClick
            })
          )
      );
    }

    // ============================================
    // MAP COMPONENT (Fixed zoom, hover popups with 1s delay, names on zoom)
    // ============================================
    const NAME_LABEL_ZOOM_THRESHOLD = 16; // Show names when zoomed in past this level
    
    function LawyerMap({ lawyers, activeLawyer, onLawyerSelect, onAddToShortlist, user, shortlist }) {
      const mapRef = React.useRef(null);
      const markersRef = React.useRef(null);
      const markersMapRef = React.useRef(new Map());
      const nameLabelsRef = React.useRef([]); // Store name label markers
      const closeTimeoutRef = React.useRef(null);
      const currentPopupRef = React.useRef(null);
      const isHoveringPopupRef = React.useRef(false);
      const [currentZoom, setCurrentZoom] = React.useState(DEFAULT_ZOOM);

      React.useEffect(() => {
        if (!mapRef.current) {
          mapRef.current = L.map('map', {
            zoomControl: true
          }).setView([DEFAULT_CENTER.lat, DEFAULT_CENTER.lng], DEFAULT_ZOOM);
          
          L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap'
          }).addTo(mapRef.current);
          
          markersRef.current = L.markerClusterGroup({
            maxClusterRadius: 30, // Smaller radius to reduce bunching
            spiderfyOnMaxZoom: true,
            showCoverageOnHover: false,
            disableClusteringAtZoom: 17, // Disable clustering at high zoom levels
            spiderfyDistanceMultiplier: 2 // Spread out spiderfied markers more
          });
          mapRef.current.addLayer(markersRef.current);
          
          // Listen for zoom changes to show/hide name labels
          mapRef.current.on('zoomend', () => {
            setCurrentZoom(mapRef.current.getZoom());
          });
        }
        return () => {
          if (mapRef.current) {
            mapRef.current.remove();
            mapRef.current = null;
          }
        };
      }, []);

      React.useEffect(() => {
        if (!markersRef.current) return;
        markersRef.current.clearLayers();
        markersMapRef.current.clear();

        // Clear any existing popup listeners
        if (closeTimeoutRef.current) {
          clearTimeout(closeTimeoutRef.current);
        }

        lawyers.forEach(lawyer => {
          const { lat, lng } = lawyer.coordinates;
          const isActive = lawyer.id === activeLawyer?.id;
          const isShortlisted = shortlist.some(l => l.id === lawyer.id);
          
          const icon = L.divIcon({
            className: 'custom-marker',
            html: `<div style="
              width: ${isActive ? '40px' : '32px'};
              height: ${isActive ? '40px' : '32px'};
              background: ${isActive ? '#e5a835' : '#1e3a8a'};
              border: 3px solid white;
              border-radius: 50%;
              box-shadow: 0 2px 8px rgba(0,0,0,0.3);
              display: flex;
              align-items: center;
              justify-content: center;
              transition: all 0.2s ease;
              cursor: pointer;
            "><span style="color: ${isActive ? '#0f172a' : 'white'}; font-size: ${isActive ? '16px' : '14px'};">âš–ï¸</span></div>`,
            iconSize: [isActive ? 40 : 32, isActive ? 40 : 32],
            iconAnchor: [isActive ? 20 : 16, isActive ? 40 : 32],
            popupAnchor: [0, isActive ? -40 : -32]
          });

          const marker = L.marker([lat, lng], { icon });
          
          // Create popup content with working View Profile link
          const popupContent = `
            <div style="padding: 12px; min-width: 220px; max-width: 280px;" class="lawyer-popup" data-lawyer-id="${lawyer.id}">
              <h4 style="font-weight: 600; margin: 0 0 4px 0; color: #111827; font-size: 15px;">${lawyer.fullName}</h4>
              <p style="font-size: 13px; color: #6b7280; margin: 0 0 8px 0;">${lawyer.firmName}</p>
              <span style="display: inline-block; padding: 3px 10px; background: #eff6ff; color: #1e40af; border-radius: 20px; font-size: 11px; font-weight: 500; margin-bottom: 10px;">${lawyer.category}</span>
              <div style="display: flex; gap: 8px; margin-top: 8px;">
                <a href="${lawyer.officialBio}" target="_blank" rel="noopener noreferrer" onclick="event.stopPropagation();" style="flex: 1; display: flex; align-items: center; justify-content: center; gap: 4px; padding: 8px 12px; background: #2563eb; color: white; border-radius: 8px; font-size: 12px; font-weight: 500; text-decoration: none; cursor: pointer;">View Profile</a>
                <button onclick="event.stopPropagation(); window.addToShortlistFromMap('${lawyer.id}')" style="flex: 1; display: flex; align-items: center; justify-content: center; gap: 4px; padding: 8px 12px; background: ${isShortlisted ? '#fef2f2' : '#f3f4f6'}; color: ${isShortlisted ? '#dc2626' : '#374151'}; border: 1px solid ${isShortlisted ? '#fecaca' : '#e5e7eb'}; border-radius: 8px; font-size: 12px; font-weight: 500; cursor: pointer;">${isShortlisted ? 'â™¥ Saved' : 'â™¡ Shortlist'}</button>
              </div>
            </div>
          `;
          
          // Create popup with auto-close disabled
          const popup = L.popup({
            closeButton: false,
            autoClose: false,
            closeOnClick: false,
            className: 'lawyer-marker-popup',
            offset: [0, -10]
          }).setContent(popupContent);
          
          marker.bindPopup(popup);
          
          // Function to schedule popup close
          const scheduleClose = () => {
            if (closeTimeoutRef.current) {
              clearTimeout(closeTimeoutRef.current);
            }
            closeTimeoutRef.current = setTimeout(() => {
              if (!isHoveringPopupRef.current && currentPopupRef.current) {
                currentPopupRef.current.closePopup();
                currentPopupRef.current = null;
              }
            }, 1000); // 1 second delay
          };
          
          // Open popup on marker hover
          marker.on('mouseover', function() {
            // Clear any pending close
            if (closeTimeoutRef.current) {
              clearTimeout(closeTimeoutRef.current);
            }
            
            // Close any existing popup
            if (currentPopupRef.current && currentPopupRef.current !== this) {
              currentPopupRef.current.closePopup();
            }
            
            this.openPopup();
            currentPopupRef.current = this;
          });
          
          // Schedule close on marker mouseout
          marker.on('mouseout', function() {
            scheduleClose();
          });
          
          marker.on('click', () => onLawyerSelect(lawyer));
          markersRef.current.addLayer(marker);
          markersMapRef.current.set(lawyer.id, marker);
        });

        // Global event listeners for popup hover detection
        const handleMouseOver = (e) => {
          const popupEl = e.target.closest('.leaflet-popup');
          if (popupEl) {
            isHoveringPopupRef.current = true;
            if (closeTimeoutRef.current) {
              clearTimeout(closeTimeoutRef.current);
            }
          }
        };
        
        const handleMouseOut = (e) => {
          const popupEl = e.target.closest('.leaflet-popup');
          if (popupEl) {
            // Check if we're still inside the popup
            const relatedTarget = e.relatedTarget;
            if (!popupEl.contains(relatedTarget)) {
              isHoveringPopupRef.current = false;
              // Schedule close after 1 second
              closeTimeoutRef.current = setTimeout(() => {
                if (!isHoveringPopupRef.current && currentPopupRef.current) {
                  currentPopupRef.current.closePopup();
                  currentPopupRef.current = null;
                }
              }, 1000);
            }
          }
        };
        
        document.addEventListener('mouseover', handleMouseOver, true);
        document.addEventListener('mouseout', handleMouseOut, true);
        
        return () => {
          document.removeEventListener('mouseover', handleMouseOver, true);
          document.removeEventListener('mouseout', handleMouseOut, true);
        };
      }, [lawyers, activeLawyer, shortlist, onLawyerSelect]);

      // Pan to active lawyer WITHOUT changing zoom
      React.useEffect(() => {
        if (activeLawyer && mapRef.current) {
          const { lat, lng } = activeLawyer.coordinates;
          mapRef.current.panTo([lat, lng], {
            duration: 1.5,
            easeLinearity: 0.25
          });
        }
      }, [activeLawyer]);

      // Show/hide name labels based on zoom level
      React.useEffect(() => {
        if (!mapRef.current) return;
        
        // Remove existing name labels
        nameLabelsRef.current.forEach(label => {
          mapRef.current.removeLayer(label);
        });
        nameLabelsRef.current = [];
        
        // Add name labels if zoomed in enough
        if (currentZoom >= NAME_LABEL_ZOOM_THRESHOLD) {
          lawyers.forEach(lawyer => {
            const { lat, lng } = lawyer.coordinates;
            const isActive = lawyer.id === activeLawyer?.id;
            
            // Create a name label using a DivIcon positioned below the marker
            // High contrast design: dark background with white text for visibility
            const nameLabel = L.marker([lat, lng], {
              icon: L.divIcon({
                className: 'lawyer-name-label',
                html: `<div style="
                  background: ${isActive ? '#2563eb' : '#0f172a'};
                  color: white;
                  padding: 6px 10px;
                  border-radius: 6px;
                  font-size: 12px;
                  white-space: nowrap;
                  box-shadow: 0 3px 10px rgba(0,0,0,0.3);
                  border: 2px solid ${isActive ? '#60a5fa' : '#334155'};
                  transform: translateX(-50%);
                  position: relative;
                  left: 50%;
                  text-align: center;
                  min-width: 120px;
                ">
                  <div style="font-weight: 700; font-size: 12px; margin-bottom: 2px;">${lawyer.fullName}</div>
                  <div style="font-weight: 400; font-size: 10px; opacity: 0.85;">${lawyer.firmName}</div>
                </div>`,
                iconSize: [0, 0],
                iconAnchor: [0, -25] // Position below the marker
              }),
              interactive: false, // Don't interfere with marker clicks
              zIndexOffset: -1000 // Below the markers
            });
            
            nameLabel.addTo(mapRef.current);
            nameLabelsRef.current.push(nameLabel);
          });
        }
      }, [currentZoom, lawyers, activeLawyer]);

      return h('div', { className: 'relative h-full p-2' },
        h('div', { className: 'map-container h-full overflow-hidden' },
          h('div', { id: 'map', className: 'w-full h-full rounded-lg' })
        ),
        // Location badge - positioned to the right to avoid zoom controls
        h('div', { className: 'absolute top-6 left-20 bg-white/95 backdrop-blur-sm rounded-lg px-3 py-2 shadow-md z-[1000]' },
          h('div', { className: 'flex items-center gap-2 text-sm' },
            h(Icon, { name: 'map-pin', size: 14, className: 'text-primary-600' }),
            h('span', { className: 'font-medium text-gray-700' }, 'Parramatta, NSW')
          )
        )
      );
    }

    // ============================================
    // SHORTLIST PAGE (with Header and Footer)
    // ============================================
    function ShortlistPage({ shortlist, onRemove, user, onLoginClick, onAboutClick, onGoHome }) {
      if (!user) {
        return h('div', { className: 'min-h-screen flex flex-col bg-gray-50' },
          h(Header, {
            user,
            onLoginClick,
            onShortlistClick: () => {},
            onAboutClick,
            onLogoClick: onGoHome
          }),
          h('div', { className: 'flex-1 flex items-center justify-center p-8' },
            h('div', { className: 'text-center max-w-md' },
              h('div', { className: 'w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4' },
                h(Icon, { name: 'lock', size: 32, className: 'text-gray-400' })
              ),
              h('h2', { className: 'text-xl font-semibold text-gray-900 mb-2' }, 'Login or Sign Up to Access Your Shortlist'),
              h('p', { className: 'text-gray-600 mb-6' }, 
                'Create a free account or login to save lawyers to your shortlist and access them anytime.'
              ),
              h('button', {
                onClick: onLoginClick,
                className: 'px-6 py-3 bg-primary-600 text-white font-semibold rounded-xl hover:bg-primary-700 transition-colors'
              }, 'Login / Sign Up')
            )
          ),
          h(Footer, { onPrivacyClick: null, onTermsClick: null, onDisclaimerClick: null, onContactClick: null })
        );
      }

      return h('div', { className: 'min-h-screen flex flex-col bg-gray-50' },
        h(Header, {
          user,
          onLoginClick,
          onShortlistClick: () => {},
          onAboutClick,
          onLogoClick: onGoHome
        }),
        h('main', { className: 'flex-1' },
          h('div', { className: 'max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8' },
            h('div', { className: 'mb-6' },
              h('h1', { className: 'text-3xl font-display font-bold text-gray-900' }, 'My Shortlist'),
              h('p', { className: 'text-gray-500 mt-1' }, `${shortlist.length} lawyer${shortlist.length !== 1 ? 's' : ''} saved`)
            ),
            shortlist.length === 0 ?
              h('div', { className: 'text-center py-16' },
                h('div', { className: 'w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4' },
                  h(Icon, { name: 'heart', size: 32, className: 'text-gray-400' })
                ),
                h('h3', { className: 'text-lg font-medium text-gray-900 mb-1' }, 'No saved lawyers yet'),
                h('p', { className: 'text-gray-500' }, 'Browse lawyers and click "Shortlist" to save them here.')
              ) :
              h('div', { className: 'space-y-4' },
                shortlist.map(lawyer => 
                  h('div', { key: lawyer.id, className: 'bg-white rounded-xl border border-gray-200 p-6' },
                    h('div', { className: 'flex items-start justify-between gap-4' },
                      h('div', { className: 'flex-1' },
                        h('div', { className: 'flex items-center gap-2 mb-1' },
                          h('h3', { className: 'text-lg font-semibold text-gray-900' }, lawyer.fullName),
                          lawyer.isSpecialist && h('span', { className: 'px-2 py-0.5 bg-amber-100 text-amber-800 text-xs font-medium rounded' }, 'Specialist')
                        ),
                        h('p', { className: 'text-sm text-gray-600' }, `${lawyer.title} at ${lawyer.firmName}`),
                        h('div', { className: 'flex gap-2 mt-2' },
                          h('span', { className: 'px-2.5 py-1 bg-primary-50 text-primary-700 text-xs font-medium rounded-full' }, lawyer.category)
                        ),
                        h('p', { className: 'text-sm text-gray-600 mt-3' }, lawyer.assessment),
                        h('div', { className: 'flex items-center gap-2 text-sm text-gray-500 mt-2' },
                          h(Icon, { name: 'map-pin', size: 14 }),
                          h('span', null, lawyer.officeAddress)
                        )
                      ),
                      h('button', {
                        onClick: () => onRemove(lawyer.id),
                        className: 'p-2 text-gray-400 hover:text-red-500 rounded-lg hover:bg-red-50 transition-colors',
                        'aria-label': 'Remove from shortlist'
                      }, h(Icon, { name: 'trash-2', size: 18 }))
                    ),
                    h('div', { className: 'mt-4 pt-4 border-t border-gray-100' },
                      h('a', {
                        href: lawyer.officialBio,
                        target: '_blank',
                        rel: 'noopener noreferrer',
                        className: 'inline-flex items-center gap-1.5 px-4 py-2 bg-primary-600 text-white text-sm font-medium rounded-lg hover:bg-primary-700 transition-colors'
                      },
                        h(Icon, { name: 'external-link', size: 14 }),
                        'View Profile'
                      )
                    )
                  )
                )
              )
          )
        ),
        h(Footer, { onPrivacyClick: null, onTermsClick: null, onDisclaimerClick: null, onContactClick: null })
      );
    }

    // ============================================
    // MAIN APP COMPONENT
    // ============================================
    function App() {
      const [user, setUser] = React.useState(() => storage.get('legalconnect_user', null));
      const [shortlist, setShortlist] = React.useState(() => storage.get('legalconnect_shortlist', []));
      const [activeCategory, setActiveCategory] = React.useState('all');
      const [activeLawyerId, setActiveLawyerId] = React.useState(null);
      const [currentPage, setCurrentPage] = React.useState('main'); // 'main', 'shortlist', 'about', 'privacy', 'terms', 'disclaimer'
      const [showLoginModal, setShowLoginModal] = React.useState(false);
      const [showShortlistPrompt, setShowShortlistPrompt] = React.useState(false);
      const [showOtherMessage, setShowOtherMessage] = React.useState(false);
      const [showContactModal, setShowContactModal] = React.useState(false);

      const filteredLawyers = React.useMemo(() => {
        const all = getAllLawyers();
        if (activeCategory === 'all' || activeCategory === 'other') return all;
        return all.filter(l => l.category === activeCategory);
      }, [activeCategory]);

      const activeLawyer = React.useMemo(() => {
        return filteredLawyers.find(l => l.id === activeLawyerId) || filteredLawyers[0] || null;
      }, [filteredLawyers, activeLawyerId]);

      React.useEffect(() => {
        if (filteredLawyers.length > 0 && !activeLawyerId) {
          setActiveLawyerId(filteredLawyers[0].id);
        }
      }, [filteredLawyers]);

      React.useEffect(() => {
        if (filteredLawyers.length > 0) {
          setActiveLawyerId(filteredLawyers[0].id);
        }
      }, [activeCategory]);

      React.useEffect(() => {
        storage.set('legalconnect_user', user);
      }, [user]);

      React.useEffect(() => {
        storage.set('legalconnect_shortlist', shortlist);
      }, [shortlist]);

      // Global function for map tooltip shortlist button
      React.useEffect(() => {
        window.addToShortlistFromMap = (lawyerId) => {
          const lawyer = getAllLawyers().find(l => l.id === lawyerId);
          if (lawyer) {
            handleAddToShortlist(lawyer);
          }
        };
        return () => {
          delete window.addToShortlistFromMap;
        };
      }, [user, shortlist]);

      const handleLogin = (userData) => {
        setUser(userData);
        setShowLoginModal(false);
      };

      const handleLogout = () => {
        setUser(null);
        storage.remove('legalconnect_user');
      };

      const handleShortlistClick = () => {
        setCurrentPage('shortlist');
      };

      const handleCategoryChange = (cat) => {
        if (cat === 'other') {
          setShowOtherMessage(true);
          setActiveCategory('all');
        } else {
          setShowOtherMessage(false);
          setActiveCategory(cat);
        }
      };

      const handleAddToShortlist = (lawyer) => {
        if (!user) {
          setShowShortlistPrompt(true);
          return;
        }
        
        const exists = shortlist.some(l => l.id === lawyer.id);
        if (exists) {
          setShortlist(shortlist.filter(l => l.id !== lawyer.id));
        } else {
          setShortlist([...shortlist, lawyer]);
        }
      };

      const handleRemoveFromShortlist = (id) => {
        setShortlist(shortlist.filter(l => l.id !== id));
      };

      const handleLawyerSelect = (lawyer) => {
        setActiveLawyerId(lawyer.id);
      };

      const goHome = () => {
        setCurrentPage('main');
        window.scrollTo({ top: 0, behavior: 'smooth' });
      };

      // Render Legal pages
      if (currentPage === 'privacy' || currentPage === 'terms' || currentPage === 'disclaimer') {
        return h(LegalPage, {
          pageType: currentPage,
          user,
          onLoginClick: () => user ? handleLogout() : setShowLoginModal(true),
          onShortlistClick: handleShortlistClick,
          onAboutClick: () => setCurrentPage('about'),
          onGoHome: goHome
        });
      }

      // Render About page
      if (currentPage === 'about') {
        return h(AboutPage, { 
          user,
          onLoginClick: () => user ? handleLogout() : setShowLoginModal(true),
          onShortlistClick: handleShortlistClick,
          onGoHome: goHome
        });
      }

      // Render shortlist page
      if (currentPage === 'shortlist') {
        return h(ShortlistPage, {
          shortlist,
          onRemove: handleRemoveFromShortlist,
          user,
          onLoginClick: () => user ? handleLogout() : setShowLoginModal(true),
          onAboutClick: () => setCurrentPage('about'),
          onGoHome: goHome
        });
      }

      // Render main page with hero + browse on same page
      return h('div', { className: 'min-h-screen flex flex-col' },
        h(Header, {
          user,
          onLoginClick: () => user ? handleLogout() : setShowLoginModal(true),
          onShortlistClick: handleShortlistClick,
          onAboutClick: () => setCurrentPage('about'),
          onLogoClick: () => window.scrollTo({ top: 0, behavior: 'smooth' })
        }),

        h('main', { className: 'flex-1 flex flex-col' },
          // Hero Section with category selection
          h(HeroSection, { 
            activeCategory, 
            onCategoryChange: handleCategoryChange,
            showOtherMessage
          }),

          // Browse Section - List + Map
          h('div', { className: 'flex-1 flex flex-col lg:flex-row bg-gray-100', id: 'browse' },
            // Lawyer List
            h('div', { className: 'w-full lg:w-[420px] h-[50vh] lg:h-[calc(100vh-400px)] min-h-[400px] bg-gray-50 border-r border-gray-200' },
              h(LawyerList, {
                lawyers: filteredLawyers,
                activeLawyerId,
                onActiveLawyerChange: setActiveLawyerId,
                onAddToShortlist: handleAddToShortlist,
                shortlist,
                user,
                onCardClick: handleLawyerSelect // Click card to center map on lawyer
              })
            ),
            // Map
            h('div', { className: 'flex-1 h-[50vh] lg:h-[calc(100vh-400px)] min-h-[400px] bg-gray-200' },
              h(LawyerMap, {
                lawyers: filteredLawyers,
                activeLawyer,
                onLawyerSelect: handleLawyerSelect,
                onAddToShortlist: handleAddToShortlist,
                user,
                shortlist
              })
            )
          )
        ),

        h(Footer, { 
          onPrivacyClick: () => setCurrentPage('privacy'),
          onTermsClick: () => setCurrentPage('terms'),
          onDisclaimerClick: () => setCurrentPage('disclaimer'),
          onContactClick: () => setShowContactModal(true)
        }),

        // Modals
        h(LoginModal, {
          isOpen: showLoginModal,
          onClose: () => setShowLoginModal(false),
          onLogin: handleLogin,
          onSignup: handleLogin
        }),
        h(ShortlistPromptModal, {
          isOpen: showShortlistPrompt,
          onClose: () => setShowShortlistPrompt(false),
          onLogin: () => { setShowShortlistPrompt(false); setShowLoginModal(true); }
        }),
        h(ContactModal, {
          isOpen: showContactModal,
          onClose: () => setShowContactModal(false)
        })
      );
    }

    // Render App
    ReactDOM.createRoot(document.getElementById('root')).render(h(App));
  </script>
</body>
</html>
